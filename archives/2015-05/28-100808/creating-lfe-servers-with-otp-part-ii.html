<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
  
  
  
  <head profile="http://dublincore.org/documents/dcq-html/">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1179318-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-1179318-5');
    </script>
    <meta charset="utf-8">
    <title>
    
      oubiwann | blog
      
      
      
    
    </title>
    

    
    
    
    <!-- General Metadata (site-wide) -->
    <meta name="description" content="A 21st century .plan for Duncan McGreggor">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="oubiwann | blog: version 5.0.0-SNAPSHOT, build f72b49e

">

    <!-- Google Metadata -->
    <meta name="google-site-verification" content="w0pQqmlRRJk36_i3se1w2U7qwG8kS_VqiLS2hq5Wk7g" />

    <!-- Dublic Core Metadata (site-wide) -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/">
    <meta name="DC.format" scheme="DCTERMS.IMT" content="text/html">
    <meta name="DC.type" scheme="DCTERMS.DCMIType" content="Text">
    <meta name="DC.coverage" content="2003-2019">
    <meta name="DC.rights" content="Creative Commons Attribution-ShareAlike 4.0 International License">
    <meta name="DC.publisher" content="C&amp;B|Books">
    <meta name="DCTERMS.audience" content="Developers, Software Engineers, Computer Scientists, Technologists, Programmers, Programming Language Enthusiasts, Operational Engineers">

    
    
<!-- General Metadata (per-page) -->
<meta name="author" content="">

<!-- Dublic Core Metadata (per-page) -->
<meta name="DC.title" lang="en" content="Creating LFE Servers with OTP, Part II">
<meta name="DC.creator" content="oubiwann">
<meta name="DC.subject" content="LFE">
<meta name="DC.date" content="2015-05-28">
<meta name="DC.identifier" scheme="DCTERMS.URI" content="https://oubiwann.github.io/blog/archives/2015-05/28-100808/creating-lfe-servers-with-otp-part-ii.html">
<meta name="DCTERMS.abstract" content="Taking the LFE gen_server to the next level">

<!-- Facebook's OpenGraph Metadata -->
<meta property="og:site_name" content="o|b">
<meta property="og:title" content="Creating LFE Servers with OTP, Part II">
<meta property="og:url" content="https://oubiwann.github.io/blog/archives/2015-05/28-100808/creating-lfe-servers-with-otp-part-ii.html">
<meta property="og:type" content="blog">
<meta property="og:description" content="Taking the LFE gen_server to the next level">
<meta property="og:image" content="https://oubiwann.github.ioimg/lfe.png">
<meta property="article:author" content="">
<meta property="article:published_time" content="2015-05-28 10:08:08">
<meta property="article:modified_time" content="">
<meta property="og:updated_time" content="">
<meta property="article:section" content="LFE">


<!-- Twitter Card Metadata -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site:id" content="@oubiwann">
<meta name="twitter:creator:id" content="@ErlangLisp">
<meta name="twitter:title" content="Creating LFE Servers with OTP, Part II">
<meta name="twitter:url" content="https://oubiwann.github.io/blog/archives/2015-05/28-100808/creating-lfe-servers-with-otp-part-ii.html">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://oubiwann.github.ioimg/lfe.png">

    
    

    <link rel="alternate" type="application/atom+xml" title="Feed" href="/blog/atom.xml" />
    

    <!-- Webfonts Setup /-->
    <link href="https://fonts.googleapis.com/css?family=Maitree&amp;subset=latin-ext"
          rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Yantramanav&amp;subset=latin-ext"
          rel="stylesheet" type="text/css">

    <!-- Bootstrap/Custom Styles Setup /-->
    <link rel="stylesheet" href="/blog/assets/highlightjs/styles/arta.css" type="text/css">
    <link rel="stylesheet" href="/blog/assets/font-awesome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/blog/assets/bootswatch/css/custom.min.css" rel="stylesheet" type="text/css" id="theme">
    <link rel="stylesheet" href="/blog/css/theme.css" rel="stylesheet" type="text/css" id="theme" media="screen">

    <!-- Favicon Setup /-->
    <link rel="apple-touch-icon" sizes="180x180" href="/blog/icons/apple-touch-icon.png?v=3">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/icons/favicon-32x32.png?v=3">
    <link rel="icon" type="image/png" sizes="16x16" href="/blog/icons/favicon-16x16.png?v=3">
    <link rel="manifest" href="/blog/icons/manifest.json?v=3">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg?v=3" color="#5bbad5">
    <link rel="shortcut icon" href="/blog/icons/favicon.ico?v=3">
    <meta name="apple-mobile-web-app-title" content="FRMX">
    <meta name="application-name" content="o|b">
    <meta name="msapplication-config" content="/blog/icons/browserconfig.xml?v=3">
    <meta name="theme-color" content="#ffffff">
    
    

    <!-- Scripts /-->
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
    
    
  

  </head>
  
  <body>
  
   
    <header class="tiny">
      
<div class="navbar navbar-expand-lg fixed-top navbar-light bg-light">
  <div class="container">
    <div class="navbar-brand-wrapper">
      <a href="/blog/" class="navbar-brand">o|b</a>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

   <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/blog/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/archives">Archives</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/categories">Categories</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/tags">Tags</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/authors">Authors</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" id="about">About <span class="caret"></span></a>
          <div class="dropdown-menu" aria-labelledby="about">
            <a class="dropdown-item" href="/blog/about/">The Blog</a>
            <a class="dropdown-item" href="/blog/about/contact/">Contact Us</a>
            <a class="dropdown-item" href="/blog/about/powered-by/">Powered By</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="/blog/about/license/">License</a>
          </div>
        </li>
      </ul>

      <ul class="nav navbar-nav ml-auto social-nav">
        <li class="nav-item">
          <a href="/blog/atom.xml" alt="Atom Feed">
            <i class="fa fa-feed first"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://twitter.com/oubiwann" alt="Twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="/googleplus" alt="Google+">
            <i class="fa fa-google-plus"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="http://github.com/oubiwann" alt="Github">
            <i class="fa fa-github"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://groups.google.com/forum/#!forum/oubiwann-blog-new-posts"
             alt="Email Notifications">
            <i class="fa fa-envelope"></i>
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

    </header>
    
    
    <main id="main-content">
      

    <!-- Page Content -->
    <div class="container page-content">

      <div class="row">

        <!-- Post Content Column -->
        <div class="col-lg-12">

          <!-- Title -->
          <h1 class="mt-4">Creating LFE Servers with OTP, Part II</h1>

          <!-- Author -->
          <p class="lead">
            Posted on May 28,
            2015 by
            <a href="/blog/authors#oubiwann">oubiwann</a>
          </p>

          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link show active" data-toggle="tab" href="#content">Content</a>
            </li>
            <li class="nav-item">
              <a class="nav-link show" data-toggle="tab" href="#metadata">Metadata</a>
            </li>
          </ul>

          <br/>

          <div id="post-content" class="tab-content">
            <div class="tab-pane fade active show" id="content">

          <!-- Post Image -->
          <img class="card-img-top" src="img/lfe.png" alt="Blog post image">

          <hr>

          <!-- Post Content -->
          <p><a href="/assets/images/posts/LFE-signal.jpg"><img class="left thumb" src="/assets/images/posts/LFE-signal.jpg" /></a> In the last post, we went on a whirlwind tour of ``gen_server``'s basic functionality: we created a callback module which embodied our logic; we created a server module that was responsible for setting up the loop;, and we added an API to wrap ``gen<i>server:cast`` and ``gen</i>server:call`` functions that passed messages to our callback logic. In this post we're going to follow up on that work:</p><ul><li>Update our code to use OTP community best practices</li><li>Add support for stopping the server.</li><li>Improve the support for handling unexpected messages.</li></ul><h2>LFE OTP Tutorial Series</h2><ul><li><a href='/tutorials/2015/05/23/1720-new-series-lfe-otp-tutorials/'>Introducing the LFE OTP Tutorials</a></li><li><a href='/tutorials/2015/05/24/1808-what-is-otp/'>What is OTP?</a></li><li><a href='/tutorials/2015/05/25/0929-prelude-to-otp/'>Prelude to OTP</a></li><li><a href='/tutorials/2015/05/26/1112-creating-servers-with-the-gen_server-behaviour/'>Creating LFE Servers with OTP, Part I</a></li><li><a href='/tutorials/2015/05/28/1008-creating-servers-with-the-gen_server-behaviour-ii/'>Creating LFE Servers with OTP, Part II</a></li><li><a href='/tutorials/2015/09/18/1604-distributed-lfe/'>Distributed LFE</a></li></ul><p>You can leave feedback for the LFE OTP tutorials <a href='https://github.com/lfe/blog/issues/7'>here</a>.</p><h2>In This Post</h2><ul><li>Requirements, Assumptions, and Code</li><li>Best Practices<ul><li>Unified Code</li><li>Exports</li><li>All Callbacks</li></ul></li><li>Stopping a ``gen_server``</li><li>Expecting the Unexpected</li><li>Full Source Code</li><li>Learning More About ``gen_server``</li><li>Up Next</li></ul><h2>Requirements, Assumptions, and Code</h2><p>Before reading this tutorial, be sure you should have read the ones preceding it in this series. For a list of what you need to have installed before working through the examples as well as getting the source code for these tutorials, please see the post <a href='/tutorials/2015-05-25-0929-prelude-to-otp/'>Prelude to OTP</a>.</p><p>In the last post, we compiled all the code and started the LFE REPL with the following command:</p><pre><code class="bash">$ cd tut01
$ make repl
</code></pre><h2>Best Practices</h2><p>The next few sections will cover some of the best practices that we glossed over or completely ignored in the last post. Our intent was to convey the core concepts of ``gen_server`` without drowning the new OTP developer in a sea of details. Now it's time to complete your ``gen_server`` education and tell you the rest of the story. Ready to swim?</p><h3>Unified Code</h3><p>Even though OTP provides the developer with the ability to define the callbacks in a separate module like we did in the last post, in practice this feature is not generally utilized. Instead, both the callback logic and the server code are kept in the same module. This makes it possible for the two aspects of ``gen_server`` to share private functions and it makes it easier to refer to each other (no need to make calls to another module).</p><p>It may seem a bit awkward at first, though, since you'll be using the same name for the ``gen_server`` and for the callback module (namely, ``(MODULE)``), but you'll get used to it quickly enough.</p><p>The ``tut01/src`` directory which holds the source code for this post (and the previous one) has a combined module, ``tut01.lfe`` holding the functionality we previously defined in ``tut01-server.lfe`` and ``tut01-callback.lfe``. We'll give a full listing at the end of this post.</p><h3>Explicit Exports</h3><p>The next thing we need to fix from the last tutorial is the lazy use of ``(export all)``. It is much better to declare exactly what you want exported for public use. The explicit exporting of public functions is part of the (self-) documentation for your module.</p><p>When opening your module in an editor, this is going to be less helpful:</p><pre><code class="lisp">&#40;defmodule tut01-server
  &#40;behaviour gen&#95;server&#41;
  &#40;export all&#41;&#41;
</code></pre><p>Than this:</p><pre><code class="lisp">&#40;defmodule tut01
  &#40;behaviour gen&#95;server&#41;
  &#40;export
    ;; gen&#95;server implementation
    &#40;start 0&#41;
    &#40;stop 0&#41;
    ;; callback implementation
    &#40;init 1&#41;
    &#40;handle&#95;call 3&#41;
    &#40;handle&#95;cast 2&#41;
    &#40;handle&#95;info 2&#41;
    &#40;terminate 2&#41;
    &#40;code&#95;change 3&#41;
    ;; server API
    &#40;inc 0&#41;
    &#40;dec 0&#41;
    &#40;amount? 0&#41;&#41;&#41;
</code></pre><h3>All Callbacks</h3><p>The last best practice we're going to look at now is the inclusion of all callbacks. When you compile an LFE module that declares an OTP behaviour, it doesn't complain if you leave out a required function. It successfully compiles and will run just fine. However, when you do this you are not abiding by the contract with the OTP world. This can have the practical result of causing unexpected bugs and/or breakages in code, especially in the code of your users who would be expecting your application to respect the OTP contract.</p><p>So what do we need to add to our new, unified ``gen_server`` and callback module that we left out in the last post? Here are the additional required ``gen_server`` functions:</p><ul><li>``handle_info/2``</li><li>``terminate/2``</li><li>``code_change/3``</li></ul><p>The final, optional ``gen<i>server`` callback function is ``format</i>status/2``, but we'll discuss that in a future post when we touch on the topic of monitoring nodes.</p><p>The functions ``handle_info`` and ``terminate`` will be the topic of the next sections, so let's stub out a quick ``code_change`` implementation:</p><pre><code class="lisp">&#40;defun code&#95;change &#40;&#95;old-version state &#95;extra&#41;
  `#&#40;ok ,state&#41;&#41;
</code></pre><p>A future blog post will dive into the topic of hot-loading new code into a running server (zero downtime!), and at that point we'll provide a <em>real</em> implementation of ``code_change``. For now, what we have above will be a placeholder.</p><h2>API Update Reprise: Stopping a ``gen_server``</h2><p>In the last post we showed how easy it was to update an API (and what was needed in order to do so). We're going to return to this topic, but with a twist. We're going to add a ``stop`` function to our API, but stopping a service is a little more involved than a regular API addition. We'll explain as we go.</p><p>Here's the new API function:</p><pre><code class="lisp">&#40;defun stop &#40;&#41;
  &#40;gen&#95;server:call &#40;server-name&#41; 'stop&#41;&#41;
</code></pre><p>That’s the easy bit. Now let’s add support for this new ``stop`` message to our ``handle_call`` callback function:</p><pre><code class="lisp">&#40;defun handle&#95;call
  &#40;&#40;'amount &#95;caller state-data&#41;
    `#&#40;reply ,state-data ,state-data&#41;&#41;
  &#40;&#40;'stop &#95;caller state-data&#41;
    `#&#40;stop shutdown ok state-data&#41;&#41;
  &#40;&#40;message &#95;caller state-data&#41;
    `#&#40;reply ,&#40;unknown-command&#41; ,state-data&#41;&#41;&#41;
</code></pre><p>Notice that we've got a new return tuple: it doesn't start with ``reply`` or ``noreply``. Instead, it sends the ``stop`` message.</p><p>If we tried to run our server with just this change to the callback, we would get an error after calling our new ``(tut01:stop)`` API function:</p><pre><code class="erlang">=ERROR REPORT==== 25-May-2015::19:27:16 ===
&#42;&#42; Generic server tut01 terminating
&#42;&#42; Last message in was stop
&#42;&#42; When Server state == 'state-data'
&#42;&#42; Reason for termination ==
&#42;&#42; {'function not exported',
       &#91;{'tut01-callback',terminate,...},
        {gen&#95;server,try&#95;terminate,...},
        {gen&#95;server,terminate,7,...},
        {gen&#95;server,handle&#95;msg,5,...},
        {proc&#95;lib,init&#95;p&#95;do&#95;apply,3,...}&#93;}
</code></pre><p>You will see that error message when you haven’t defined the ``terminate`` callback function. Here’s a quick one. Let's fix that:</p><pre><code class="lisp">&#40;defun terminate &#40;&#95;reason &#95;state-data&#41;
  'ok&#41;
</code></pre><p>Now when we stop our server using our new API, we have success:</p><pre><code class="lisp">&gt; &#40;tut01:start&#41;
#&#40;ok &lt;0.35.0&gt;&#41;
&gt; &#40;tut01:stop&#41;
ok
</code></pre><p>And we can demonstrate that it’s really stopped by trying to call our ``amount?`` API function:</p><pre><code class="lisp">&gt; &#40;tut01:amount?&#41;
exception exit: #&#40;noproc #&#40;gen&#95;server call &#40;tut01 amount&#41;&#41;&#41;
  in gen&#95;server:call/2 &#40;gen&#95;server.erl, line 182&#41;
</code></pre><h2>Expecting the Unexpected</h2><p>In the last post, we added a quick catch-all pattern to our ``handle_call`` callback to provide a user with feedback whenever they attempt to call an API that's not defined. This is rather fragile, since there are different types of messages which can be sent to the ``gen_server``, many of which won't be done by a human user.</p><p>Here's an example stray message:</p><pre><code class="lisp">&gt; &#40;! &#40;whereis 'tut01&#41; 'bingo&#41;
bingo
</code></pre><p>Which causes the termination of our server:</p><pre><code class="erlang">=ERROR REPORT==== 30-May-2015::20:38:25 ===
&#42;&#42; Generic server tut01 terminating
&#42;&#42; Last message in was bingo
&#42;&#42; When Server state == 0
&#42;&#42; Reason for termination ==
&#42;&#42; {'function not exported',
       &#91;{tut01,handle&#95;info,&#91;bingo,0&#93;,&#91;&#93;},
        {gen&#95;server,try&#95;dispatch,4,&#91;{file,&quot;gen&#95;server.erl&quot;},{line,593}&#93;},
        {gen&#95;server,handle&#95;msg,5,&#91;{file,&quot;gen&#95;server.erl&quot;},{line,659}&#93;},
        {proc&#95;lib,init&#95;p&#95;do&#95;apply,3,&#91;{file,&quot;proc&#95;lib.erl&quot;},{line,237}&#93;}&#93;}
</code></pre><p>The callback that ``gen<i>server`` will use to handle undefined messages is ``handle</i>info``. Let's create an implementation for this callback which is less fragile that our original:</p><pre><code class="lisp">&#40;defun handle&#95;info
  &#40;&#40;`#&#40;EXIT ,&#95;pid normal&#41; state-data&#41;
   `#&#40;noreply ,state-data&#41;&#41;
  &#40;&#40;`#&#40;EXIT ,pid ,reason&#41; state-data&#41;
   &#40;io:format &quot;Process &#126;p exited! &#40;Reason: &#126;p&#41;&#126;n&quot; `&#40;,pid ,reason&#41;&#41;
   `#&#40;noreply ,state-data&#41;&#41;
  &#40;&#40;&#95;msg state-data&#41;
   `#&#40;noreply ,state-data&#41;&#41;&#41;
</code></pre><p>Let's play ``gen_server`` bingo again:</p><pre><code class="lisp">&gt; &#40;tut01:start&#41;
#&#40;ok &lt;0.35.0&gt;&#41;
&gt; &#40;! &#40;whereis 'tut01&#41; 'bingo&#41;
bingo
</code></pre><p>So much nicer!</p><h2>Full Source Code</h2><p>With all these changes, we have some new source code to enjoy:</p><pre><code class="lisp">&#40;defmodule tut01
  &#40;behaviour gen&#95;server&#41;
  &#40;export
    ;; gen&#95;server implementation
    &#40;start 0&#41;
    &#40;stop 0&#41;
    ;; callback implementation
    &#40;init 1&#41;
    &#40;handle&#95;call 3&#41;
    &#40;handle&#95;cast 2&#41;
    &#40;handle&#95;info 2&#41;
    &#40;terminate 2&#41;
    &#40;code&#95;change 3&#41;
    ;; server API
    &#40;inc 0&#41;
    &#40;dec 0&#41;
    &#40;amount? 0&#41;&#41;&#41;

;;; config functions

&#40;defun server-name &#40;&#41; &#40;MODULE&#41;&#41;
&#40;defun callback-module &#40;&#41; &#40;MODULE&#41;&#41;
&#40;defun initial-state &#40;&#41; 0&#41;
&#40;defun genserver-opts &#40;&#41; '&#40;&#41;&#41;
&#40;defun register-name &#40;&#41; `#&#40;local ,&#40;server-name&#41;&#41;&#41;
&#40;defun unknown-command &#40;&#41; #&#40;error &quot;Unknown command.&quot;&#41;&#41;

;;; gen&#95;server implementation

&#40;defun start &#40;&#41;
  &#40;gen&#95;server:start &#40;register-name&#41;
                    &#40;callback-module&#41;
                    &#40;initial-state&#41;
                    &#40;genserver-opts&#41;&#41;&#41;

&#40;defun stop &#40;&#41;
  &#40;gen&#95;server:call &#40;server-name&#41; 'stop&#41;&#41;

;;; callback implementation

&#40;defun init &#40;initial-state&#41;
  `#&#40;ok ,initial-state&#41;&#41;

&#40;defun handle&#95;cast
  &#40;&#40;'inc state-data&#41;
    `#&#40;noreply ,&#40;+ 1 state-data&#41;&#41;&#41;
  &#40;&#40;'dec state-data&#41;
    `#&#40;noreply ,&#40;- state-data 1&#41;&#41;&#41;&#41;

&#40;defun handle&#95;call
  &#40;&#40;'amount &#95;caller state-data&#41;
    `#&#40;reply ,state-data ,state-data&#41;&#41;
  &#40;&#40;'stop &#95;caller state-data&#41;
    `#&#40;stop shutdown ok state-data&#41;&#41;
  &#40;&#40;message &#95;caller state-data&#41;
    `#&#40;reply ,&#40;unknown-command&#41; ,state-data&#41;&#41;&#41;

&#40;defun handle&#95;info
  &#40;&#40;`#&#40;EXIT ,&#95;pid normal&#41; state-data&#41;
   `#&#40;noreply ,state-data&#41;&#41;
  &#40;&#40;`#&#40;EXIT ,pid ,reason&#41; state-data&#41;
   &#40;io:format &quot;Process &#126;p exited! &#40;Reason: &#126;p&#41;&#126;n&quot; `&#40;,pid ,reason&#41;&#41;
   `#&#40;noreply ,state-data&#41;&#41;
  &#40;&#40;&#95;msg state-data&#41;
   `#&#40;noreply ,state-data&#41;&#41;&#41;

&#40;defun terminate &#40;&#95;reason &#95;state-data&#41;
  'ok&#41;

&#40;defun code&#95;change &#40;&#95;old-version state &#95;extra&#41;
  `#&#40;ok ,state&#41;&#41;

;;; our server API

&#40;defun inc &#40;&#41;
  &#40;gen&#95;server:cast &#40;server-name&#41; 'inc&#41;&#41;

&#40;defun dec &#40;&#41;
  &#40;gen&#95;server:cast &#40;server-name&#41; 'dec&#41;&#41;

&#40;defun amount? &#40;&#41;
  &#40;gen&#95;server:call &#40;server-name&#41; 'amount&#41;&#41;
</code></pre><p>Ah, look at all those beautiful parentheses :-) [<sup>stop-placement]</sup></p><h2>Learning More About ``gen_server``</h2><p>There’s a lot of information we didn’t cover in this tutorial, however it’s enough to get started writing simple OTP servers in LFE. If you’d like to learn more, one of the newest books out there on the topic has been recently published by O’Reilly: <a href='http://shop.oreilly.com/product/0636920024149.do'>Designing for Scalability with Erlang/OTP</a>. The chapter on ``gen_server`` covers this material in much more detail, including timeouts, deadlocks, hibernating, and custom global registries.</p><p>Another good resource, once you get up to speed, is the <a href='http://www.erlang.org/doc/man/gen_server.html'>Erlang documentation</a> (and <a href='http://www.erlang.org/doc/design_principles/gen_server_concepts.html'>here</a>). Often overlooked, it's actually really good and will be a constant companion for you any time you need to do something with OTP that you haven't tried before.</p><p>In future posts in this series, we will be covering bits we've left out of this tutorial, namely:</p><ul><li>``code_change`` - supporting hot-loading of code in a running system</li><li>``format_status`` - providing custom status data for a running server</li></ul><h2>Up Next</h2><p>Before we tackle any other behaviours, we’re going to explore distributed generic servers: running our code on multiple cores and multiple machines.<h2></h2></p><h3>Footnotes</h3><p>[<sup>stop-placement]:</sup> You might have noticed that we put the ``stop`` API function<pre><code>               in with ``start``. Even though ``stop`` is not defined for
               ``gen&#95;server``, we still consider it a &quot;server management&quot;
               function and thus place it with its peer, ``start``. </code></pre></p>

            </div>
            <div class="tab-pane fade" id="metadata">

              <table class="table table-hover">
                <tbody>
                  <tr class="table-secondary">
                    <th scope="row">Author</th>
                    <td>oubiwann</td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Date</th>
                    <td>May 28,
        2015</td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Time</th>
                    <td>10:08:08</td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Category</th>
                    <td>
                        <a href="/blog/categories/#LFE">LFE</a>
                    </td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Tags</th>
                    <td>
                      
                      <a href="/blog/tags/#erlang">erlang</a>
                      
                      <a href="/blog/tags/#otp">otp</a>
                      
                      <a href="/blog/tags/#tutorials">tutorials</a>
                      
                    </td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Line&nbsp;Count</th>
                    <td>146 </td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Word&nbsp;Count</th>
                    <td>1630 </td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Character&nbsp;Count</th>
                    <td>15475 </td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>

          <hr>

          <!-- Comments Note -->
          <div class="card my-4">
            <h5 class="card-header">Comments?</h5>
            <div class="card-body">
              This blog doesn't use standard (embedded) comments; however, since
              the site is hosted on Github, if there <emphasis>is</emphasis>
              something you'd like to share, please do so by
              <a href="https://github.com/oubiwann/blog/issues/new">opening a
              "comment" ticket!</a>
            </div>
          </div>

        </div>

      </div>
      <!-- /.row -->

    </div>
    <!-- /.container -->

<!-- End main page content -->

    </main>
    
    
    <footer id="footer">
      
        <div class="row">
          <div class="col-lg-6">

            <ul class="list-unstyled">
              <li class="text-muted">Blogs</li>
              <li><a href="http://oubiwann.blogspot.com">Electric Duncan</a></li>
              <li><a href="http://blog.lfe.io/">LFE Blog</a></li>
              <li><a href="http://clojang.lfe.io/">Clojang</a></li>
              <li><a href="https://clozhang.github.io/blog/">Clozhang</a></li>
            </ul>

          </div>
          <div class="col-lg-6">
            <ul class="list-unstyled">
              <li class="float-lg-right text-muted">Github orgs</li>
              <li class="float-lg-right"><a href="https://github.com/erlsci">erlsci</a></li>
              <li class="float-lg-right"><a href="https://github.com/lfex">lfex</a></li>
              <li class="float-lg-right"><a href="https://github.com/clozhang">clozhang</a></li>
              <li class="float-lg-right"><a href="https://github.com/clojang">clojang</a></li>
              <li class="float-lg-right"><a href="https://github.com/clojusc">clojusc</a></li>
              <li class="float-lg-right"><a href="https://github.com/hexagram30">hexagram30</a></li>
            </ul>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-6">
          </div>
          <div class="col-lg-6">
            <ul class="list-unstyled">

              <li class="float-lg-right"><a href="https://github.com/masteringmatplotlib">masteringmatplotlib</a></li>
              <li class="float-lg-right"><a href="https://github.com/usgs-lcmap">usgs-lcmap</a></li>
              <li class="float-lg-right"><a href="https://github.com/nasa-ngap-archives">nasa-ngap-archives</a></li>
              <li class="float-lg-right"><a href="https://github.com/nasa-cmr-archives">nasa-cmr-archives</a></li>

            </ul>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <p><a href="http://creativecommons.org/licenses/by-sa/4.0/">
              <img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
            </a></p>
            <p class="text-muted">Content released under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License.</a>.</p>
            <p class="text-muted">Copyright &copy; Duncan McGreggor, 2003-2019</p>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <p class="text-muted">Design adapted from the Bootswatch
              <a href="https://bootswatch.com/darkly/">Darkly</a> theme.
            </p>
          </div>
        </div>


    </footer>
    
    
    <script src="/blog/assets/jquery/dist/jquery.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/popper.js/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/bootstrap/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/bootswatch/js/custom.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
  
  </body>
</html>
