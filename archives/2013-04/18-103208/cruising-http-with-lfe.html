<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
  
  
  
  <head profile="http://dublincore.org/documents/dcq-html/">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1179318-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-1179318-5');
    </script>
    <meta charset="utf-8">
    <title>
    
      oubiwann | blog
      
      
      
    
    </title>
    

    
    
    
    <!-- General Metadata (site-wide) -->
    <meta name="description" content="A 21st century .plan for Duncan McGreggor">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="oubiwann | blog: version 5.0.0-SNAPSHOT, build b08d541

">

    <!-- Google Metadata -->
    <meta name="google-site-verification" content="w0pQqmlRRJk36_i3se1w2U7qwG8kS_VqiLS2hq5Wk7g" />

    <!-- Dublic Core Metadata (site-wide) -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/">
    <meta name="DC.format" scheme="DCTERMS.IMT" content="text/html">
    <meta name="DC.type" scheme="DCTERMS.DCMIType" content="Text">
    <meta name="DC.coverage" content="2003-2019">
    <meta name="DC.rights" content="Creative Commons Attribution-ShareAlike 4.0 International License">
    <meta name="DC.publisher" content="C&amp;B|Books">
    <meta name="DCTERMS.audience" content="Developers, Software Engineers, Computer Scientists, Technologists, Programmers, Programming Language Enthusiasts, Operational Engineers">

    
    
<!-- General Metadata (per-page) -->
<meta name="author" content="">

<!-- Dublic Core Metadata (per-page) -->
<meta name="DC.title" lang="en" content="Cruising HTTP with LFE">
<meta name="DC.creator" content="oubiwann">
<meta name="DC.subject" content="">
<meta name="DC.date" content="2013-04-18">
<meta name="DC.identifier" scheme="DCTERMS.URI" content="https://oubiwann.github.io/blog/archives/2013-04/18-103208/cruising-http-with-lfe.html">
<meta name="DCTERMS.abstract" content="">

<!-- Facebook's OpenGraph Metadata -->
<meta property="og:site_name" content="o|b">
<meta property="og:title" content="Cruising HTTP with LFE">
<meta property="og:url" content="https://oubiwann.github.io/blog/archives/2013-04/18-103208/cruising-http-with-lfe.html">
<meta property="og:type" content="blog">
<meta property="og:description" content="">
<meta property="og:image" content="https://oubiwann.github.io/blog/img/ob-post-1.jpg">
<meta property="article:author" content="">
<meta property="article:published_time" content="2013-04-18 10:32:08">
<meta property="article:modified_time" content="">
<meta property="og:updated_time" content="">
<meta property="article:section" content="">


<!-- Twitter Card Metadata -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site:id" content="@oubiwann">
<meta name="twitter:creator:id" content="@oubiwann">
<meta name="twitter:title" content="Cruising HTTP with LFE">
<meta name="twitter:url" content="https://oubiwann.github.io/blog/archives/2013-04/18-103208/cruising-http-with-lfe.html">
<meta name="twitter:description" content="<p><p><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-fonndtAAXJI/UUAGF-K1LpI/AAAAAAAAADk/YZs-7OwO60 8/s1600/LispFlavoredErlang-medium.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="200" src="http://2.bp.blogspot.com/-fonndtAAXJI/UUAGF-K1LpI/AAAAAAAAAD k/YZs-7OwO608/s200/LispFlavoredErlang-medium.png" width="168" /></a></div>In the <a ...</p>">
<meta name="twitter:image" content="https://oubiwann.github.io/blog/img/ob-post-1.jpg">

    
    

    <link rel="alternate" type="application/atom+xml" title="Feed" href="/blog/atom.xml" />
    

    <!-- Webfonts Setup /-->
    <link href="https://fonts.googleapis.com/css?family=Maitree&amp;subset=latin-ext"
          rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Yantramanav&amp;subset=latin-ext"
          rel="stylesheet" type="text/css">

    <!-- Bootstrap/Custom Styles Setup /-->
    <link rel="stylesheet" href="/blog/assets/highlightjs/styles/arta.css" type="text/css">
    <link rel="stylesheet" href="/blog/assets/font-awesome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/blog/assets/bootswatch/css/custom.min.css" rel="stylesheet" type="text/css" id="theme">
    <link rel="stylesheet" href="/blog/css/theme.css" rel="stylesheet" type="text/css" id="theme" media="screen">

    <!-- Favicon Setup /-->
    <link rel="apple-touch-icon" sizes="180x180" href="/blog/icons/apple-touch-icon.png?v=3">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/icons/favicon-32x32.png?v=3">
    <link rel="icon" type="image/png" sizes="16x16" href="/blog/icons/favicon-16x16.png?v=3">
    <link rel="manifest" href="/blog/icons/manifest.json?v=3">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg?v=3" color="#5bbad5">
    <link rel="shortcut icon" href="/blog/icons/favicon.ico?v=3">
    <meta name="apple-mobile-web-app-title" content="FRMX">
    <meta name="application-name" content="o|b">
    <meta name="msapplication-config" content="/blog/icons/browserconfig.xml?v=3">
    <meta name="theme-color" content="#ffffff">
    
    
    
    
    
  

  </head>
  
  <body>
  
   
    <header class="tiny">
      
<div class="navbar navbar-expand-lg fixed-top navbar-light bg-light">
  <div class="container">
    <div class="navbar-brand-wrapper">
      <a href="/blog/" class="navbar-brand">o|b</a>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

   <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/blog/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/archives">Archives</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/categories">Categories</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/tags">Tags</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/authors">Authors</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" id="about">About <span class="caret"></span></a>
          <div class="dropdown-menu" aria-labelledby="about">
            <a class="dropdown-item" href="/blog/about/">The Blog</a>
            <a class="dropdown-item" href="/blog/about/contact/">Contact Us</a>
            <a class="dropdown-item" href="/blog/about/powered-by/">Powered By</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="/blog/about/license/">License</a>
          </div>
        </li>
      </ul>

      <ul class="nav navbar-nav ml-auto social-nav">
        <li class="nav-item">
          <a href="/blog/atom.xml" alt="Atom Feed">
            <i class="fa fa-feed first"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://twitter.com/oubiwann" alt="Twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="/googleplus" alt="Google+">
            <i class="fa fa-google-plus"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="http://github.com/oubiwann" alt="Github">
            <i class="fa fa-github"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://groups.google.com/forum/#!forum/oubiwann-blog-new-posts"
             alt="Email Notifications">
            <i class="fa fa-envelope"></i>
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

    </header>
    
    
    <main id="main-content">
      

    <!-- Page Content -->
    <div class="container page-content">

      <div class="row">

        <!-- Post Content Column -->
        <div class="col-lg-12">

          <!-- Title -->
          <h1 class="mt-4">Cruising HTTP with LFE</h1>

          <!-- Author -->
          <p class="lead">
            Posted on April 18,
            2013 by
            <a href="/blog/authors#oubiwann">oubiwann</a>
          </p>

          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link show active" data-toggle="tab" href="#content">Content</a>
            </li>
            <li class="nav-item">
              <a class="nav-link show" data-toggle="tab" href="#metadata">Metadata</a>
            </li>
          </ul>

          <br/>

          <div id="post-content" class="tab-content">
            <div class="tab-pane fade active show" id="content">

          <!-- Post Image -->
          <img class="card-img-top" src="/blog/img/ob-post-1.jpg" alt="Blog post image">

          <hr>

          <!-- Post Content -->
          <p><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-fonndtAAXJI/UUAGF-K1LpI/AAAAAAAAADk/YZs-7OwO60 8/s1600/LispFlavoredErlang-medium.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="200" src="http://2.bp.blogspot.com/-fonndtAAXJI/UUAGF-K1LpI/AAAAAAAAAD k/YZs-7OwO608/s200/LispFlavoredErlang-medium.png" width="168" /></a></div>In the <a href="http://technicae.cogitat.io/2013/04/getting-started-with-lfe-on-ubuntu.h tml">last post</a>, you learned how to get LFE running on Ubuntu. This one will give you some insight into how LFE can be used in something approaching real-world problems. In the next post, we're going to jump back into <a href="http://technicae.cogitat.io/search/label/%CE%BB-calculus">the lambda calculus</a>, and we'll see some more LFE shortly after that.<br /><br />Because <a href="http://lfe.github.io/">Lisp Flavored Erlang</a> is 100% compatible with Erlang Core, it has access to all the Erlang libraries, OTP, and many third-party modules, etc.&nbsp; Naturally, this includes the Erlang HTTP client, <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">httpc</span>. Today we're going to be taking a look at how to use <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">httpc</span> from LFE. Do note, however that this post is only going to provide a taste, just enough to give you a sense of the flavor, as it were. <br /><br />If you would like more details, be sure to not only give the <a href="http://erlang.org/doc/man/httpc.html">official docs</a> a thorough reading, but to take a look at the <a href="http://erlang.org/doc/apps/inets/http_client.html">HTTP Client section</a> of the <a href="http://erlang.org/doc/apps/inets/"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">inets</span> Reference Manual</a>.<br /><br />Note that for the returned values below, I elide large data structures. If you run them in the LFE REPL yourself, you can view them in all of the line-consuming glory. <br /><br /><b>Synchronous <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">GET</span></b><br /><br />Let's get started with a simple example. The first thing we need to do is start the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">inets</span> application. With that done, we'll then be able to make client requests:<br /><script src="https://gist.github.com/5381504.js?file=http-sync-1.lfe.lisp">< /script> Now we can perform an HTTP <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">GET</span>: <script src="https://gist.github.com/5381504.js?file=http-sync-2.lfe.lisp"></script> T his just makes a straight-forward HTTP request (defaults to <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">GET</span>) and returns a bunch of associated data:<br /><ul><li>HTTP version</li><li>status code</li><li>reason phrase</li><li>headers</li><li>body</li></ul>All of that data is dumped into our <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">result</span> variable. Here's the same <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">GET</span> but with pattern matching set up so that we can easily access all that data:<br /><script src="https://gist.github.com/5381504.js?file=http-sync-3.lfe.lisp">< /script> For those not familiar with Erlang patterns, we've just told LFE the following:<br /><ul><li>the return value of the function we're going to call is going to be a tuple composed of an atom (<span style="font-family: &quot;Courier New&quot;,Courier,monospace;">'ok</span>) and another tuple</li><li>the nested tuple is going to be composed of a tuple, some headers, and a body</li><li>the <i>next</i> nested tuple is going to be composed of the HTTP version, status code, and status code phrase</li></ul>If you'd like to learn more about using patterns in LFE, be sure to view the <a href="http://lfe.github.io/user-guide/diving/5.html">patterns page</a> of the LFE User Guide. <br /><br />Once the request returns, we can check out the variables we set in the pattern:<br /><script src="https://gist.github.com/5381504.js?file=http-sync-4.lfe.lisp"></script> < br />That's great if everything goes as expected and we get a response from the server. What happens if we don't?<br /><br />Well, errors don't have the same nested data structure that the non-error results have, so we're going to have to make some changes to our pattern if we want to extract parts of the error reason. Pattern matching for just the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">'error</span> atom and the error reason, we can get a sense of what that data structure looks like:<br /><script src="https://gist.github.com/5381504.js?file=http-sync-5.lfe.lisp">< /script> <br />Looking at just the data stored in the reason variable, we see:<br /><script src="https://gist.github.com/5381504.js?file=http-sync-6.lfe.lisp"></script> I f you check out the <a href="http://erlang.org/doc/man/httpc.html#request-1">docs for <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">httpc</span> <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">request</span></a> and look under "Types", you will see that the error returned can be one of three things:<br /><ul><li>a tuple of <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">connect_failed</span> and additional data</li><li>a tuple of <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">send_failed</span> and additional data</li><li>or just unspecified additional data</li></ul>In our example our additional data is a tuple of the address we were trying to connect to and the specific error type that for our failed connection.<br /><br /><br /><b>Async <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">GET</span></b><br /><br />Now that we've taken a quick look at the synchronous example, let's make a foray into async. We'll still be using <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">httpc</span>'s <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">request</span> function, but we'll need to use one of the longer forms were extra options need to be passed, since that's how you tell the <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">request</span> function to perform the request asynchronously and not synchronously.<br /><br />For clarity of introducing the additional options, we're going to define some variables first: <script src="https://gist.github.com/5381591.js?file=http-async-1.lfe.lisp"></script>Y ou can read more about the options in the <a href="http://erlang.org/doc/man/httpc.html#request-1"><span style="font-family : &quot;Courier New&quot;,Courier,monospace;">httpc</span> docs</a>.<br /><br />With the variables defined, let's make our async call: <script src="https://gist.github.com/5381591.js?file=http-async-2.lfe.lisp"></script>  The sender receives the results, and since we sent from the LFE REPL, that's the process that will receive the data. Let's keep our pattern simple at first &ndash; just the request id and the result data:<br /><script src="https://gist.github.com/5381591.js?file=http-async-3.lfe.lisp"></script>  Needless to say, parsing the returned data is a waste of Erlang's pattern matching, so let's go back and do that again, this time with a nice pattern to capture the results. We'll need to do another request, though, so that something gets sent to the shell:<br /><script src="https://gist.github.com/5381591.js?file=http-async-4.lfe.lisp"></script>  Now we can set up a pattern that will allow us to extract and print just the bits that we're looking for. The thing to keep in mind here is that the scope for the variables is within the receive call, so we'll need to display the values within that scope:<br /><script src="https://gist.github.com/5381591.js?file=http-async-5.lfe.lisp"></script>  This should demonstrate the slight differences in usage and result patterns between the sync and async modes.<br /><br />Well, that about sums it up for an intro to the HTTP client in LFE! But one last thing, for the sake of completeness. Once we're done, we can shut down inets:<br /><script src="https://gist.github.com/5381591.js?file=http-async-6.lfe.lisp"></script>  <br /><br /></p>

            </div>
            <div class="tab-pane fade" id="metadata">

              <table class="table table-hover">
                <tbody>
                  <tr class="table-secondary">
                    <th scope="row">Author</th>
                    <td>oubiwann</td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Date</th>
                    <td>April 18,
        2013</td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Time</th>
                    <td>10:32:08</td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Category</th>
                    <td>
                        <a href="/blog/categories/#"></a>
                    </td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Tags</th>
                    <td>
                      
                      <a href="/blog/tags/#async">async</a>
                      
                      <a href="/blog/tags/#concurrency">concurrency</a>
                      
                      <a href="/blog/tags/#erlang">erlang</a>
                      
                      <a href="/blog/tags/#howtos">howtos</a>
                      
                      <a href="/blog/tags/#http">http</a>
                      
                      <a href="/blog/tags/#lfe">lfe</a>
                      
                      <a href="/blog/tags/#lisp">lisp</a>
                      
                      <a href="/blog/tags/#programming">programming</a>
                      
                    </td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Line&nbsp;Count</th>
                    <td>1 </td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Word&nbsp;Count</th>
                    <td>967 </td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Character&nbsp;Count</th>
                    <td>8494 </td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>

          <hr>

          <!-- Comments Note -->
          <div class="card my-4">
            <h5 class="card-header">Comments?</h5>
            <div class="card-body">
              This blog doesn't use standard (embedded) comments; however, since
              the site is hosted on Github, if there <emphasis>is</emphasis>
              something you'd like to share, please do so by
              <a href="https://github.com/oubiwann/blog/issues/new">opening a
              "comment" ticket!</a>
            </div>
          </div>

        </div>

      </div>
      <!-- /.row -->

    </div>
    <!-- /.container -->

<!-- End main page content -->

    </main>
    
    
    <footer id="footer">
      
        <div class="row">
          <div class="col-lg-6">

            <ul class="list-unstyled">
              <li class="text-muted">Blogs</li>
              <li><a href="http://oubiwann.blogspot.com">Electric Duncan</a></li>
              <li><a href="http://blog.lfe.io/">LFE Blog</a></li>
              <li><a href="http://clojang.lfe.io/">Clojang</a></li>
              <li><a href="https://clozhang.github.io/blog/">Clozhang</a></li>
            </ul>

          </div>
          <div class="col-lg-6">
            <ul class="list-unstyled">
              <li class="float-lg-right text-muted">Github orgs</li>
              <li class="float-lg-right"><a href="https://github.com/erlsci">erlsci</a></li>
              <li class="float-lg-right"><a href="https://github.com/lfex">lfex</a></li>
              <li class="float-lg-right"><a href="https://github.com/clozhang">clozhang</a></li>
              <li class="float-lg-right"><a href="https://github.com/clojang">clojang</a></li>
              <li class="float-lg-right"><a href="https://github.com/clojusc">clojusc</a></li>
              <li class="float-lg-right"><a href="https://github.com/hexagram30">hexagram30</a></li>
            </ul>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-6">
          </div>
          <div class="col-lg-6">
            <ul class="list-unstyled">

              <li class="float-lg-right"><a href="https://github.com/masteringmatplotlib">masteringmatplotlib</a></li>
              <li class="float-lg-right"><a href="https://github.com/usgs-lcmap">usgs-lcmap</a></li>
              <li class="float-lg-right"><a href="https://github.com/nasa-ngap-archives">nasa-ngap-archives</a></li>
              <li class="float-lg-right"><a href="https://github.com/nasa-cmr-archives">nasa-cmr-archives</a></li>

            </ul>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <p><a href="http://creativecommons.org/licenses/by-sa/4.0/">
              <img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
            </a></p>
            <p class="text-muted">Content released under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License.</a>.</p>
            <p class="text-muted">Copyright &copy; Duncan McGreggor, 2003-2019</p>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <p class="text-muted">Design adapted from the Bootswatch
              <a href="https://bootswatch.com/darkly/">Darkly</a> theme.
            </p>
          </div>
        </div>


    </footer>
    
    
    <script src="/blog/assets/jquery/dist/jquery.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/popper.js/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/bootstrap/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/bootswatch/js/custom.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
  
  </body>
</html>
