<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
  
  
  
  <head profile="http://dublincore.org/documents/dcq-html/">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1179318-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-1179318-5');
    </script>
    <meta charset="utf-8">
    <title>
    
      oubiwann | blog
      
      
      
    
    </title>
    

    
    
    
    <!-- General Metadata (site-wide) -->
    <meta name="description" content="A 21st century .plan for Duncan McGreggor">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="oubiwann | blog: version 5.0.0-SNAPSHOT, build ef95945

">

    <!-- Google Metadata -->
    <meta name="google-site-verification" content="w0pQqmlRRJk36_i3se1w2U7qwG8kS_VqiLS2hq5Wk7g" />

    <!-- Dublic Core Metadata (site-wide) -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/">
    <meta name="DC.format" scheme="DCTERMS.IMT" content="text/html">
    <meta name="DC.type" scheme="DCTERMS.DCMIType" content="Text">
    <meta name="DC.coverage" content="2003-2019">
    <meta name="DC.rights" content="Creative Commons Attribution-ShareAlike 4.0 International License">
    <meta name="DC.publisher" content="C&amp;B|Books">
    <meta name="DCTERMS.audience" content="Developers, Software Engineers, Computer Scientists, Technologists, Programmers, Programming Language Enthusiasts, Operational Engineers">

    
    
<!-- General Metadata (per-page) -->
<meta name="author" content="">

<!-- Dublic Core Metadata (per-page) -->
<meta name="DC.title" lang="en" content="Hash Maps in LFE: Request for Comment">
<meta name="DC.creator" content="oubiwann">
<meta name="DC.subject" content="">
<meta name="DC.date" content="2014-04-02">
<meta name="DC.identifier" scheme="DCTERMS.URI" content="https://oubiwann.github.io/blog/archives/2014-04/02-123308/hash-maps-in-lfe-request-for-comment.html">
<meta name="DCTERMS.abstract" content="">

<!-- Facebook's OpenGraph Metadata -->
<meta property="og:site_name" content="o|b">
<meta property="og:title" content="Hash Maps in LFE: Request for Comment">
<meta property="og:url" content="https://oubiwann.github.io/blog/archives/2014-04/02-123308/hash-maps-in-lfe-request-for-comment.html">
<meta property="og:type" content="blog">
<meta property="og:description" content="">
<meta property="og:image" content="https://oubiwann.github.io/blog/img/ob-post-5.jpg">
<meta property="article:author" content="">
<meta property="article:published_time" content="2014-04-02 12:33:08">
<meta property="article:modified_time" content="">
<meta property="og:updated_time" content="">
<meta property="article:section" content="">


<!-- Twitter Card Metadata -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site:id" content="@oubiwann">
<meta name="twitter:creator:id" content="@oubiwann">
<meta name="twitter:title" content="Hash Maps in LFE: Request for Comment">
<meta name="twitter:url" content="https://oubiwann.github.io/blog/archives/2014-04/02-123308/hash-maps-in-lfe-request-for-comment.html">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://oubiwann.github.io/blog/img/ob-post-5.jpg">

    
    

    <link rel="alternate" type="application/atom+xml" title="Feed" href="/blog/atom.xml" />
    

    <!-- Webfonts Setup /-->
    <link href="https://fonts.googleapis.com/css?family=Maitree&amp;subset=latin-ext"
          rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Yantramanav&amp;subset=latin-ext"
          rel="stylesheet" type="text/css">

    <!-- Bootstrap/Custom Styles Setup /-->
    <link rel="stylesheet" href="/blog/assets/highlightjs/styles/arta.css" type="text/css">
    <link rel="stylesheet" href="/blog/assets/font-awesome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/blog/assets/bootswatch/css/custom.min.css" rel="stylesheet" type="text/css" id="theme">
    <link rel="stylesheet" href="/blog/css/theme.css" rel="stylesheet" type="text/css" id="theme" media="screen">

    <!-- Favicon Setup /-->
    <link rel="apple-touch-icon" sizes="180x180" href="/blog/icons/apple-touch-icon.png?v=3">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/icons/favicon-32x32.png?v=3">
    <link rel="icon" type="image/png" sizes="16x16" href="/blog/icons/favicon-16x16.png?v=3">
    <link rel="manifest" href="/blog/icons/manifest.json?v=3">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg?v=3" color="#5bbad5">
    <link rel="shortcut icon" href="/blog/icons/favicon.ico?v=3">
    <meta name="apple-mobile-web-app-title" content="FRMX">
    <meta name="application-name" content="o|b">
    <meta name="msapplication-config" content="/blog/icons/browserconfig.xml?v=3">
    <meta name="theme-color" content="#ffffff">
    
    
    
    
    
  

  </head>
  
  <body>
  
   
    <header class="tiny">
      
<div class="navbar navbar-expand-lg fixed-top navbar-light bg-light">
  <div class="container">
    <div class="navbar-brand-wrapper">
      <a href="/blog/" class="navbar-brand">o|b</a>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

   <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/blog/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/archives">Archives</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/categories">Categories</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/tags">Tags</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/authors">Authors</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" id="about">About <span class="caret"></span></a>
          <div class="dropdown-menu" aria-labelledby="about">
            <a class="dropdown-item" href="/blog/about/">The Blog</a>
            <a class="dropdown-item" href="/blog/about/contact/">Contact Us</a>
            <a class="dropdown-item" href="/blog/about/powered-by/">Powered By</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="/blog/about/license/">License</a>
          </div>
        </li>
      </ul>

      <ul class="nav navbar-nav ml-auto social-nav">
        <li class="nav-item">
          <a href="/blog/atom.xml" alt="Atom Feed">
            <i class="fa fa-feed first"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://twitter.com/oubiwann" alt="Twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="/googleplus" alt="Google+">
            <i class="fa fa-google-plus"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="http://github.com/oubiwann" alt="Github">
            <i class="fa fa-github"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://groups.google.com/forum/#!forum/oubiwann-blog-new-posts"
             alt="Email Notifications">
            <i class="fa fa-envelope"></i>
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

    </header>
    
    
    <main id="main-content">
      

    <!-- Page Content -->
    <div class="container page-content">

      <div class="row">

        <!-- Post Content Column -->
        <div class="col-lg-12">

          <!-- Title -->
          <h1 class="mt-4">Hash Maps in LFE: Request for Comment</h1>

          <!-- Author -->
          <p class="lead">
            Posted on April 02,
            2014 by
            <a href="/blog/authors#oubiwann">oubiwann</a>
          </p>

          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link show active" data-toggle="tab" href="#content">Content</a>
            </li>
            <li class="nav-item">
              <a class="nav-link show" data-toggle="tab" href="#metadata">Metadata</a>
            </li>
          </ul>

          <br/>

          <div id="post-content" class="tab-content">
            <div class="tab-pane fade active show" id="content">

          <!-- Post Image -->
          <img class="card-img-top" src="/blog/img/ob-post-5.jpg" alt="Blog post image">

          <hr>

          <!-- Post Content -->
          <p><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-fonndtAAXJI/UUAGF-K1LpI/AAAAAAAAADk/YZs-7OwO60 8/s3200/LispFlavoredErlang-medium.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-fonndtAAXJI/UUAGF-K1LpI/AAAAAAAAADk/YZs-7OwO608 /s3200/LispFlavoredErlang-medium.png" height="200" width="168" /></a></div>As you may have heard, hash maps are coming to Erlang in R17. We're all pretty excited about this. The LFE community (yes, we have one... hey, being headquartered on <a href="http://en.wikipedia.org/wiki/Gotland">Gutland</a> keeps us lean!) has been abuzz with excitement: do we get some new syntax for Erlang maps? Or just record-like macros?<br /><br />That's still an open question. There's a good chance that if we find an elegant solution, we'll get some new syntax.<br /><br />In an effort to <a href="https://groups.google.com/d/msg/lisp-flavoured-erlang/zAU_z2i6lis/0yVECx o3JNIJ">(re)start</a> this <a href="https://groups.google.com/d/msg/lisp-flavoured-erlang/k3hbyyeg9oM/p4PM3U Qt1WUJ">conversation</a> and get us thinking about the possibilities, I've drawn together some examples from various Lisps. At the end of the post, we'll review some related data structures in LFE... as a point of contrast and possible guidance.<br /><br />Note that I've tried to keep the code grouped in larger gists, not split up with prose wedged between them. This should make it easier to compare and contrast whole examples at a glance.<br /><br />Before we dive into the Lisps, let's take a look at maps in Erlang:<br /><br /><b>Erlang Maps</b><br /><div><script src="https://gist.github.com/9701054.js?file=01-maps.erl"></script></div><br /<blockquote><p><b>Common Lisp Hash Tables</b><br /><div><script src="https://gist.github.com/9701054.js?file=02-maps.lisp"></script></div><br<br />/><b>Racket Hash Tables</b><br /><div><script src="https://gist.github.com/9701054.js?file=03-maps.rkt"></script></div><br / <b>Clojure Hash Maps</b><br /><div><script src="https://gist.github.com/9701054.js?file=04-maps.clj"></script></div><br / <b>Shen Property Lists</b><br /><div><script src="https://gist.github.com/9701054.js?file=05-plists.shen.lisp"></script></d iv><br /><b>OpenLisp Hash Tables</b><br /><div><script src="https://gist.github.com/9701054.js?file=06-openlisp-maps.lisp"></script>< /div><br /><b>LFE Property Lists</b><br /><div><script src="https://gist.github.com/9701054.js?file=08-plists.lfe"></script></div><br /><b>LFE orddicts</b><br /><div><script src="https://gist.github.com/9701054.js?file=09-orddicts.lfe"></script></div>< br />I summarized some very basic usability and aesthetic thoughts on the LFE mail list, but I'll restate them here:<br /><ul><li>Erlang syntax really is quite powerful; I continue to be impressed.</li><li>Clojure was by far the most enjoyable to work with... however, doing something similar in LFE would require quite a bit of additions for language or macro infrastructure. My concern here is that we'd end up with a Clojure clone rather than something distinctly Erlang-Lispy.</li><li>Racket had the fullest and most useful set of hash functions (and best docs).</li><li>Chicken Scheme was probably second.</li><li>Common Lisp was probably (I hate to say it) the most awkward of the bunch). I'm hoping we can avoid pretty much everything the way it was done there :-/</li></ul>One of the things that makes Clojure such a joy to work with is the unified aspect of core functions and how one uses these to manipulate data structures of different types. Most other implementations have functions/macros that are dedicated to working with just maps. While that's clean and definitely has a strong appeal, Clojure reflects a great deal of elegance.<br /><br />That being said, I don't think today is the day to propose unifying features for LFE/Erlang data types ;-) (To be honest, though, it's <i>certainly</i> in the back of my mind... this is probably also true for many folks on the mail list.)<br /><br />Given my positive experience with maps (hash tables) in Racket, and Robert's initial proposed functions like <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">map-new</span>, <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">map-set</span>, I'd encourage us to look to Racket for some inspiration:<br /><ul><li><a href="http://docs.racket-lang.org/reference/hashtables.html" target="_blank">h ttp://docs.racket-lang.org/<wbr></wbr>reference/hashtables.html</a></li></ul>A dditional thoughts:<br /><ul><li>"map" has a specific meaning in FPs <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">(: lists map)</span>, and there's a little bit of cognitive dissonance for me when I look at <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">map-*</span></li><li>In my experience, applications generally don't have too many records; however, I've known apps with 100s and 1000s of instances of hash maps; as such, the idea of creating macros for each hash-map (e.g., <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">my-map-get</span>, <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">my-map-set</span>, ...) terrifies me a little. I don't believe this has been proposed, and I don't know enough about LFE's internals (much less, Erlang's) to be able to discuss this with any certainty.</li><li>The thought did occur that we could put all the map functions in a module e.g.,<span style="font-family: &quot;Courier New&quot;,Courier,monospace;"> (: maps new ... )</span>, etc. I haven't actually looked at the Erlang source and don't know how maps are implemented in R17 yet (nor how that functionality is presented to the developer). Obviously, once I have, this point will be more clear for me.</li></ul>With this done, I then did a <a href="https://groups.google.com/d/msg/lisp-flavoured-erlang/zAU_z2i6lis/0yVECx o3JNIJ">thought experiment</a> in potential syntax additions for LFE. Below are the series of gists that demonstrate this.<br /><br />Looking at this Erlang syntax: <br /><div><script src="https://gist.github.com/9938515.js?file=01-maps.erl"></script></div><br / My fingers want to do something like this in LFE: <br /><div><script src="https://gist.github.com/9938515.js?file=02-maps.lfe"></script></div><br / That feels pretty natural, from the LFE perspective. However, it looks like it might require hacking on the tuple-parsing logic (or splitting that into two code paths: one for regular tuple-parsing, and the other for maps...?). <br /><br />The above syntax also lends itself nicely to these: <br /><div><script src="https://gist.github.com/9938515.js?file=03-maps.lfe"></scr ipt></div><br />The question that arises for me is "how would we do this when calling functions?" Perhaps one of these: <br /><div><script src="https://gist.github.com/9938515.js?file=04-maps.lfe"></script></div><br / Then, for Joe's other example: <br /><div><script src="https://gist.github.com/9938515.js?file=05-maps.erl"></script></div><br / We'd have this for LFE: <br /><div><script src="https://gist.github.com/9938515.js?file=06-maps.lfe"></script></div><br / Before we pattern match on this, let's look at Erlang pattern matching for tuples: <br /><div><script src="https://gist.github.com/9938515.js?file=07-maps.erl"></script></div><br / Compare this with pattern matching elements of a tuple in LFE: <br /><div><script src="https://gist.github.com/9938515.js?file=08-maps.lfe"></scr ipt></div><br />With that in our minds, we turn to Joe's matching example against a specific map element: <br /><div><script src="https://gist.github.com/9938515.js?file=09-maps.erl"></script></div><br / And we could do the same in LFE like this: <br /><div><script src="https://gist.github.com/9938515.js?file=10-maps.lfe"></script></div><br / I'm <i>really</i> uncertain about <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">add-pair</span> and <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">update-pair</span>, both the need for them and the names. Interested to hear from others who know how map is implemented in Erlang and the best way to work with that in LFE... <br /><br />  </p></blockquote></p>

            </div>
            <div class="tab-pane fade" id="metadata">

              <table class="table table-hover">
                <tbody>
                  <tr class="table-secondary">
                    <th scope="row">Author</th>
                    <td>oubiwann</td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Date</th>
                    <td>April 02,
        2014</td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Time</th>
                    <td>12:33:08</td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Category</th>
                    <td>
                        <a href="/blog/categories/#"></a>
                    </td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Tags</th>
                    <td>
                      
                      <a href="/blog/tags/#comparisons">comparisons</a>
                      
                      <a href="/blog/tags/#data">data</a>
                      
                      <a href="/blog/tags/#data structures">data structures</a>
                      
                      <a href="/blog/tags/#erlang">erlang</a>
                      
                      <a href="/blog/tags/#hash maps">hash maps</a>
                      
                      <a href="/blog/tags/#hash tables">hash tables</a>
                      
                      <a href="/blog/tags/#hashes">hashes</a>
                      
                      <a href="/blog/tags/#lfe">lfe</a>
                      
                      <a href="/blog/tags/#lisp">lisp</a>
                      
                      <a href="/blog/tags/#maps">maps</a>
                      
                      <a href="/blog/tags/#property lists">property lists</a>
                      
                      <a href="/blog/tags/#records">records</a>
                      
                      <a href="/blog/tags/#scheme">scheme</a>
                      
                    </td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Line&nbsp;Count</th>
                    <td>1 </td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Word&nbsp;Count</th>
                    <td>929 </td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Character&nbsp;Count</th>
                    <td>8361 </td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>

          <hr>

          <!-- Comments Note -->
          <div class="card my-4">
            <h5 class="card-header">Comments?</h5>
            <div class="card-body">
              This blog doesn't use standard (embedded) comments; however, since
              the site is hosted on Github, if there <emphasis>is</emphasis>
              something you'd like to share, please do so by
              <a href="https://github.com/oubiwann/blog/issues/new">opening a
              "comment" ticket!</a>
            </div>
          </div>

        </div>

      </div>
      <!-- /.row -->

    </div>
    <!-- /.container -->

<!-- End main page content -->

    </main>
    
    
    <footer id="footer">
      
        <div class="row">
          <div class="col-lg-6">

            <ul class="list-unstyled">
              <li class="text-muted">Blogs</li>
              <li><a href="http://oubiwann.blogspot.com">Electric Duncan</a></li>
              <li><a href="http://blog.lfe.io/">LFE Blog</a></li>
              <li><a href="http://clojang.lfe.io/">Clojang</a></li>
              <li><a href="https://clozhang.github.io/blog/">Clozhang</a></li>
            </ul>

          </div>
          <div class="col-lg-6">
            <ul class="list-unstyled">
              <li class="float-lg-right text-muted">Github orgs</li>
              <li class="float-lg-right"><a href="https://github.com/erlsci">erlsci</a></li>
              <li class="float-lg-right"><a href="https://github.com/lfex">lfex</a></li>
              <li class="float-lg-right"><a href="https://github.com/clozhang">clozhang</a></li>
              <li class="float-lg-right"><a href="https://github.com/clojang">clojang</a></li>
              <li class="float-lg-right"><a href="https://github.com/clojusc">clojusc</a></li>
              <li class="float-lg-right"><a href="https://github.com/hexagram30">hexagram30</a></li>
            </ul>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-6">
          </div>
          <div class="col-lg-6">
            <ul class="list-unstyled">

              <li class="float-lg-right"><a href="https://github.com/masteringmatplotlib">masteringmatplotlib</a></li>
              <li class="float-lg-right"><a href="https://github.com/usgs-lcmap">usgs-lcmap</a></li>
              <li class="float-lg-right"><a href="https://github.com/nasa-ngap-archives">nasa-ngap-archives</a></li>
              <li class="float-lg-right"><a href="https://github.com/nasa-cmr-archives">nasa-cmr-archives</a></li>

            </ul>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <p><a href="http://creativecommons.org/licenses/by-sa/4.0/">
              <img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
            </a></p>
            <p class="text-muted">Content released under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License.</a>.</p>
            <p class="text-muted">Copyright &copy; Duncan McGreggor, 2003-2019</p>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <p class="text-muted">Design adapted from the Bootswatch
              <a href="https://bootswatch.com/darkly/">Darkly</a> theme.
            </p>
          </div>
        </div>


    </footer>
    
    
    <script src="/blog/assets/jquery/dist/jquery.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/popper.js/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/bootstrap/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/bootswatch/js/custom.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
  
  </body>
</html>
