<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
  
  
  
  <head profile="http://dublincore.org/documents/dcq-html/">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1179318-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-1179318-5');
    </script>
    <meta charset="utf-8">
    <title>
    
      oubiwann | blog
      
      
      
    
    </title>
    

    
    
    
    <!-- General Metadata (site-wide) -->
    <meta name="description" content="A 21st century .plan for Duncan McGreggor">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="oubiwann | blog: version 5.0.0-SNAPSHOT, build 38c457a

">

    <!-- Google Metadata -->
    <meta name="google-site-verification" content="w0pQqmlRRJk36_i3se1w2U7qwG8kS_VqiLS2hq5Wk7g" />

    <!-- Dublic Core Metadata (site-wide) -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/">
    <meta name="DC.format" scheme="DCTERMS.IMT" content="text/html">
    <meta name="DC.type" scheme="DCTERMS.DCMIType" content="Text">
    <meta name="DC.coverage" content="2003-2019">
    <meta name="DC.rights" content="Creative Commons Attribution-ShareAlike 4.0 International License">
    <meta name="DC.publisher" content="C&amp;B|Books">
    <meta name="DCTERMS.audience" content="Developers, Software Engineers, Computer Scientists, Technologists, Programmers, Programming Language Enthusiasts, Operational Engineers">

    
    
<!-- General Metadata (per-page) -->
<meta name="author" content="">

<!-- Dublic Core Metadata (per-page) -->
<meta name="DC.title" lang="en" content="Clojang, JInterface, &amp; core.async">
<meta name="DC.creator" content="oubiwann">
<meta name="DC.subject" content="Information">
<meta name="DC.date" content="2017-02-24">
<meta name="DC.identifier" scheme="DCTERMS.URI" content="https://oubiwann.github.io/blog/archives/2017-02/24-014224/clojang-jinterface-core-async.html">
<meta name="DCTERMS.abstract" content="Passing Comments on Internals with Possible Future Development">

<!-- Facebook's OpenGraph Metadata -->
<meta property="og:site_name" content="o|b">
<meta property="og:title" content="Clojang, JInterface, &amp; core.async">
<meta property="og:url" content="https://oubiwann.github.io/blog/archives/2017-02/24-014224/clojang-jinterface-core-async.html">
<meta property="og:type" content="blog">
<meta property="og:description" content="Passing Comments on Internals with Possible Future Development">
<meta property="og:image" content="https://oubiwann.github.io/blog/img/ob-post-2.jpg">
<meta property="article:author" content="">
<meta property="article:published_time" content="2017-02-24 01:42:24">
<meta property="article:modified_time" content="">
<meta property="og:updated_time" content="">
<meta property="article:section" content="Information">


<!-- Twitter Card Metadata -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site:id" content="@oubiwann">
<meta name="twitter:creator:id" content="@clojang">
<meta name="twitter:title" content="Clojang, JInterface, &amp; core.async">
<meta name="twitter:url" content="https://oubiwann.github.io/blog/archives/2017-02/24-014224/clojang-jinterface-core-async.html">
<meta name="twitter:description" content="<p><p>The discussion on Slack the other day kicked off with a question about how messages are consumed in Clojang (and thus jiface and JInterface), and ...</p>">
<meta name="twitter:image" content="https://oubiwann.github.io/blog/img/ob-post-2.jpg">

    
    

    <link rel="alternate" type="application/atom+xml" title="Feed" href="/blog/atom.xml" />
    

    <!-- Webfonts Setup /-->
    <link href="https://fonts.googleapis.com/css?family=Maitree&amp;subset=latin-ext"
          rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Yantramanav&amp;subset=latin-ext"
          rel="stylesheet" type="text/css">

    <!-- Bootstrap/Custom Styles Setup /-->
    <link rel="stylesheet" href="/blog/assets/highlightjs/styles/arta.css" type="text/css">
    <link rel="stylesheet" href="/blog/assets/font-awesome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/blog/assets/bootswatch/css/custom.min.css" rel="stylesheet" type="text/css" id="theme">
    <link rel="stylesheet" href="/blog/css/theme.css" rel="stylesheet" type="text/css" id="theme" media="screen">

    <!-- Favicon Setup /-->
    <link rel="apple-touch-icon" sizes="180x180" href="/blog/icons/apple-touch-icon.png?v=3">
    <link rel="icon" type="image/png" sizes="32x32" href="/blog/icons/favicon-32x32.png?v=3">
    <link rel="icon" type="image/png" sizes="16x16" href="/blog/icons/favicon-16x16.png?v=3">
    <link rel="manifest" href="/blog/icons/manifest.json?v=3">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg?v=3" color="#5bbad5">
    <link rel="shortcut icon" href="/blog/icons/favicon.ico?v=3">
    <meta name="apple-mobile-web-app-title" content="FRMX">
    <meta name="application-name" content="o|b">
    <meta name="msapplication-config" content="/blog/icons/browserconfig.xml?v=3">
    <meta name="theme-color" content="#ffffff">
    
    
    
    
    
  

  </head>
  
  <body>
  
   
    <header class="tiny">
      
<div class="navbar navbar-expand-lg fixed-top navbar-light bg-light">
  <div class="container">
    <div class="navbar-brand-wrapper">
      <a href="/blog/" class="navbar-brand">o|b</a>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

   <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/blog/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/archives">Archives</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/categories">Categories</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/tags">Tags</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog/authors">Authors</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" id="about">About <span class="caret"></span></a>
          <div class="dropdown-menu" aria-labelledby="about">
            <a class="dropdown-item" href="/blog/about/">The Blog</a>
            <a class="dropdown-item" href="/blog/about/contact/">Contact Us</a>
            <a class="dropdown-item" href="/blog/about/powered-by/">Powered By</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="/blog/about/license/">License</a>
          </div>
        </li>
      </ul>

      <ul class="nav navbar-nav ml-auto social-nav">
        <li class="nav-item">
          <a href="/blog/atom.xml" alt="Atom Feed">
            <i class="fa fa-feed first"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://twitter.com/oubiwann" alt="Twitter">
            <i class="fa fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="/googleplus" alt="Google+">
            <i class="fa fa-google-plus"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="http://github.com/oubiwann" alt="Github">
            <i class="fa fa-github"></i>
          </a>
        </li>
        <li class="nav-item">
          <a href="https://groups.google.com/forum/#!forum/oubiwann-blog-new-posts"
             alt="Email Notifications">
            <i class="fa fa-envelope"></i>
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

    </header>
    
    
    <main id="main-content">
      

    <!-- Page Content -->
    <div class="container page-content">

      <div class="row">

        <!-- Post Content Column -->
        <div class="col-lg-12">

          <!-- Title -->
          <h1 class="mt-4">Clojang, JInterface, &amp; core.async</h1>

          <!-- Author -->
          <p class="lead">
            Posted on February 24,
            2017 by
            <a href="/blog/authors#oubiwann">oubiwann</a>
          </p>

          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link show active" data-toggle="tab" href="#content">Content</a>
            </li>
            <li class="nav-item">
              <a class="nav-link show" data-toggle="tab" href="#metadata">Metadata</a>
            </li>
          </ul>

          <br/>

          <div id="post-content" class="tab-content">
            <div class="tab-pane fade active show" id="content">

          <!-- Post Image -->
          <img class="card-img-top" src="/blog/img/ob-post-2.jpg" alt="Blog post image">

          <hr>

          <!-- Post Content -->
          <p>The discussion on Slack the other day kicked off with a question about how messages are consumed in Clojang (and thus jiface and JInterface), and whether, in Clojure code, one could use <code>core.async</code> to do this.</p><p>We'll take a very quick deep (while at the same time superficial) dive into this, but then answer some broader questions to provide a better context for JInterface and the projects built upon it.</p><h2>Receiving Messages</h2><p>If you are using the <code>clojang</code> library, receiving messages is as simple as the following (assuming you've followed the best practice of adding the Clojang <code>agent</code> dependency in your <code>project.clj</code> file and set the <code>:java-agents</code> option):</p><pre><code class="cl">&#40;require '&#91;clojang.core :refer &#91;receive&#93;&#93;

&#40;receive&#41;
</code></pre><p>At which point, your code blocks until a message is received. When a message comes in, <code>clojang</code> will automatically convert the Java-OTP hybrid types to Clojure types; when you reply, the conversion will take place in the other direction.</p><p>A fuller examples is viewable here:</p><ul><li><a href='https://github.com/clojang/lfecljapp/blob/master/src/clj/cljnode/server.clj'>https://github.com/clojang/lfecljapp/blob/master/src/clj/cljnode/server.clj</a></li></ul><p>Under the hood (in the <code>clojang</code> library), a default OTP node and associated mbox are being used (using the Clojure-idiomatic library <code>jiface</code>). Under <em>that</em> hood, Erlang's JInterface Java library is using threads, sockets, and custom queues to handle in-coming and out-going messages.</p><p>In other words, not a lot of room for <code>core.async</code>, unfortunately.</p><p>However, there's a <em>little</em> bit of room :-)</p><h2>Command & Convenience Channels</h2><p>One way I use <code>core.async</code> in Clojang applications is to facilitate communications between Clojure functions (i.e., a Clojang server and client, both written in Clojure).</p><p>Here's a Clojure server that takes a <code>core.async</code> channel as an argument:</p><pre><code class="clj">&#40;defn run
  &#91;cmd-chan&#93;
  &#40;log/info &quot;Starting Clojure node with nodename =&quot;
            &#40;System/getProperty &quot;node.sname&quot;&#41;&#41;
  &#40;let &#91;init-state 0&#93;
    &#40;loop &#91;png-count init-state&#93;
      &#40;match &#40;receive&#41;
        &#91;:register caller&#93;
          &#40;do
            &#40;log/infof &quot;Got :register request from %s ...&quot; caller&#41;
            &#40;mbox/link &#40;self&#41; caller&#41;
            &#40;! caller :linked&#41;
            &#40;recur png-count&#41;&#41;
        &#91;:ping caller&#93;
          &#40;do
            &#40;log/infof &quot;Got :ping request from %s ...&quot; caller&#41;
            &#40;! caller :pong&#41;
            &#40;recur &#40;inc png-count&#41;&#41;&#41;
        &#91;:get-ping-count caller&#93;
          &#40;do
            &#40;log/infof &quot;Got :get-ping-count request from %s ...&quot;  caller&#41;
            &#40;! caller png-count&#41;
            &#40;recur png-count&#41;&#41;
        &#91;:stop caller&#93;
          &#40;do
            &#40;log/warnf &quot;Got :stop request from %s ...&quot; caller&#41;
            &#40;! caller :stopping&#41;
            :stopped&#41;
        &#91;:shutdown caller&#93;
          &#40;do
            &#40;log/warnf &quot;Got :shutdown request from %s ...&quot; caller&#41;
            &#40;! caller :shutting-down&#41;
            &#40;async/&gt;! cmd-chan :shutdown&#41;&#41;
        &#91;&#95; caller&#93;
          &#40;do
            &#40;log/error &quot;Bad message received: unknown command&quot;&#41;
            &#40;! caller &#91;:error :unknown-command&#93;&#41;
            &#40;recur png-count&#41;&#41;
        &#91;&#95;&#93;
          &#40;do
            &#40;log/error &quot;Bad message received: improperly formatted&quot;&#41;
            &#40;recur png-count&#41;&#41;&#41;&#41;&#41;&#41;
</code></pre><p>In this particular case, it doesn't do too much: it simply sends a message back to the calling code when the server has been asked to shutdown. (Note that the <code>:shutdown</code> clause is sending two types of messages: first an OTP message reply is sent back to the calling OTP node &ndash; which could be either another OTP Clojure node or a BEAM node &ndash; and then a <code>core.async</code> message is pushed onto the channel that was passed to the server function. In the case where this code was copied from, that channel was started by the function that called <code>&#40;run&#41;</code>.)</p><p>That's a really simple (and not strictly necessary) example of a command channel use case for <code>core.async</code> in a Clojang app. Here's another case:</p><pre><code class="clj">&#40;defn otp-bridge
  &quot;This function creates the following in order to facilitate core.async
  communications with the Clojure OTP server:
<ol><li>A dedicated mbox for the OTP bridge &#40;what receives messages from the       OTP server&#41;
    2. The pid for the dedicated mbox
    3. A core.async channel for sending messages to the OTP server.&quot;
  &#91;&#93;
  &#40;let &#91;bridge-mbox &#40;mbox/add :otpbrige&#41;
        bridge-pid &#40;mbox/get-pid bridge-mbox&#41;
        bridge-chan &#40;async/chan&#41;&#93;
    &#40;async/go-loop &#91;&#93;
      &#40;when-let &#91;value &#40;async/&lt;! bridge-chan&#41;&#93;
        &#40;! &#91;value bridge-pid&#93;&#41;&#41;
      &#40;recur&#41;&#41;
    {:mbox bridge-mbox
     :pid bridge-pid
     :channel bridge-chan}&#41;&#41;
</code></pre></li></ol><p>As the docstring above says, this function uses <code>core.async</code> to provide a wrapper for OTP communications with a Clojang server. Interesting and kind of fun, but not really tapping into the power of <code>core.async</code>.</p><h2>Zhang</h2><p>There is an experimental project for exploring ways in which Clojure/OTP applications could maximize <code>core.async</code> while communicating with nodes, services, and full distributed systems in the BEAM world:</p><ul><li><a href='/archives/2016-02/13-121526/zhang.html'>Zhang</a>  (blog post/project announcement)</li><li><a href='http://github.com/clojang/zhang'>zhang on github</a></li></ul><p>Those two links provide some good introductory material, so I won't duplicate that here. Note, however, than while the <code>jiface</code> and <code>clojang</code> libs are stabilizing, little effort is being applied to <code>zhang</code>. As such, there's not much to the project currently.</p>

            </div>
            <div class="tab-pane fade" id="metadata">

              <table class="table table-hover">
                <tbody>
                  <tr class="table-secondary">
                    <th scope="row">Author</th>
                    <td>oubiwann</td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Date</th>
                    <td>February 24,
        2017</td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Time</th>
                    <td>01:42:24</td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Category</th>
                    <td>
                        <a href="/blog/categories/#Information">Information</a>
                    </td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Tags</th>
                    <td>
                      
                      <a href="/blog/tags/#clojang">clojang</a>
                      
                      <a href="/blog/tags/#clojure">clojure</a>
                      
                      <a href="/blog/tags/#core.async">core.async</a>
                      
                      <a href="/blog/tags/#internals">internals</a>
                      
                      <a href="/blog/tags/#jinterface">jinterface</a>
                      
                      <a href="/blog/tags/#lfecljapp">lfecljapp</a>
                      
                      <a href="/blog/tags/#zhang">zhang</a>
                      
                    </td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Line&nbsp;Count</th>
                    <td>62 </td>
                  </tr>
                  <tr class="table-secondary">
                    <th scope="row">Word&nbsp;Count</th>
                    <td>688 </td>
                  </tr>
                  <tr class="table-light">
                    <th scope="row">Character&nbsp;Count</th>
                    <td>6546 </td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>

          <hr>

          <!-- Comments Note -->
          <div class="card my-4">
            <h5 class="card-header">Comments?</h5>
            <div class="card-body">
              This blog doesn't use standard (embedded) comments; however, since
              the site is hosted on Github, if there <emphasis>is</emphasis>
              something you'd like to share, please do so by
              <a href="https://github.com/oubiwann/blog/issues/new">opening a
              "comment" ticket!</a>
            </div>
          </div>

        </div>

      </div>
      <!-- /.row -->

    </div>
    <!-- /.container -->

<!-- End main page content -->

    </main>
    
    
    <footer id="footer">
      
        <div class="row">
          <div class="col-lg-6">

            <ul class="list-unstyled">
              <li class="text-muted">Blogs</li>
              <li><a href="http://oubiwann.blogspot.com">Electric Duncan</a></li>
              <li><a href="http://blog.lfe.io/">LFE Blog</a></li>
              <li><a href="http://clojang.lfe.io/">Clojang</a></li>
              <li><a href="https://clozhang.github.io/blog/">Clozhang</a></li>
            </ul>

          </div>
          <div class="col-lg-6">
            <ul class="list-unstyled">
              <li class="float-lg-right text-muted">Github orgs</li>
              <li class="float-lg-right"><a href="https://github.com/erlsci">erlsci</a></li>
              <li class="float-lg-right"><a href="https://github.com/lfex">lfex</a></li>
              <li class="float-lg-right"><a href="https://github.com/clozhang">clozhang</a></li>
              <li class="float-lg-right"><a href="https://github.com/clojang">clojang</a></li>
              <li class="float-lg-right"><a href="https://github.com/clojusc">clojusc</a></li>
              <li class="float-lg-right"><a href="https://github.com/hexagram30">hexagram30</a></li>
            </ul>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-6">
          </div>
          <div class="col-lg-6">
            <ul class="list-unstyled">

              <li class="float-lg-right"><a href="https://github.com/masteringmatplotlib">masteringmatplotlib</a></li>
              <li class="float-lg-right"><a href="https://github.com/usgs-lcmap">usgs-lcmap</a></li>
              <li class="float-lg-right"><a href="https://github.com/nasa-ngap-archives">nasa-ngap-archives</a></li>
              <li class="float-lg-right"><a href="https://github.com/nasa-cmr-archives">nasa-cmr-archives</a></li>

            </ul>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <p><a href="http://creativecommons.org/licenses/by-sa/4.0/">
              <img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
            </a></p>
            <p class="text-muted">Content released under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License.</a>.</p>
            <p class="text-muted">Copyright &copy; Duncan McGreggor, 2003-2019</p>
          </div>
        </div>


    </footer>
    
    
    <script src="/blog/assets/jquery/dist/jquery.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/popper.js/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/bootstrap/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/bootswatch/js/custom.js" crossorigin="anonymous"></script>
    <script src="/blog/assets/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
  
  </body>
</html>
